<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1,maximum-scale=1, user-scalable=no">
	<title>服务评价指标报表</title>
	<link rel="stylesheet" href="css/com.css">
	<link rel="stylesheet" href="css/index.css">
	
</head>
<body>
	<header>
		<div class="hLeft"><button class="back"></button></div>
		<div class="hCenter"><span>服务评价指标报表</span></div>
		<div class="hRight jg">
			<div class="jg-con"><span>全司</span></div>
		</div>
		
	</header>
	<nav>
		
	</nav>
	
	<section class="type-choose">
		<label class="chooseed">
			<input type="radio" name="typeRadio" value="0" >
			<span>本日</span>
		</label>
		<label>
			<input type="radio" name="typeRadio" value="1">
			<span>本月</span>
		</label>
		<label>
			<input type="radio" name="typeRadio" value="2">
			<span>本年</span>
		</label>
	</section>

	<section class="content">
		<ul>
			<li data-title="出险支付时效">
				<span>出险支付时效</span>
				<strong>
					<span>73.20</span><i>天</i>
				</strong>
			</li>
			<li data-title="申请支付时效">
				<span>申请支付时效</span>
				<strong>
					<span>2.96</span><i>天</i>
				</strong>
			</li>
			<li data-title="犹豫期内电话回访成功率">
				<span>犹豫期内电话回访成功率</span>
				<strong>
					<span>96.21</span><i>%</i>
				</strong>
			</li>
			<li data-title="亿元保费投诉量">
				<span>亿元保费投诉量</span>
				<strong>
					<span>0.1324</span><i>件</i>
				</strong>
			</li>
			<li data-title="万张保单投诉量">
				<span>万张保单投诉量</span>
				<strong>
					<span>2.331</span><i>件</i>
				</strong>
			</li>
			
			<li data-title="保单15日送达率">
				<span>保单15日送达率</span>
				<strong>
					<span>96.23</span><i>%</i>
				</strong>
			</li>
			<li data-title="保全时效">
				<span>保全时效</span>
				<strong>
					<span>1.01</span><i>天</i>
				</strong>
			</li>
			<li data-title="理赔获赔率">
				<span>理赔获赔率</span>
				<strong>
					<span>97.38</span><i>%</i>
				</strong>
			</li>
			<li data-title="投诉案件处理及时率">
				<span>投诉案件处理及时率</span>
				<strong>
					<span>100</span><i>%</i>
				</strong>
			</li>
			<li data-title="电话呼入人工接通率">
				<span>电话呼入人工接通率</span>
				<strong>
					<span>77.62</span><i>%</i>
				</strong>
			</li>
		</ul>
	</section>
	<footer>
		<label class="qs2">
			<input type="radio" name="qdRadio" value="0">
			<i></i>
			<span>全司</span>
		</label>
		<label class="gx">
			<input type="radio" name="qdRadio" value="1">
			<i></i>
			<span>个险</span>
		</label>
		<label class="fq">
			<input type="radio" name="qdRadio" value="2">
			<i></i>
			<span>健养+渠道</span>
		</label>
		<label class="dx">
			<input type="radio" name="qdRadio" value="3">
			<i></i>
			<span>电网销</span>
		</label>
	</footer>
	<script src="js/jquery.min.js"></script>
	<script>
		$(function(){
			$('nav').html(chooseDay());

			//先填充nav 在计算高度
			var h = $(document).height();
			var hh = $('header')[0].clientHeight;
			var nh = $('nav')[0].clientHeight;
			var th = $('.type-choose')[0].clientHeight;
			var fh = $('footer')[0].clientHeight;
			$('.content').css('height',( h - hh- nh- th -fh - 20)+'px');

			//解决从详情页 返回时 第一个值不会被选中的 bug
			$('input[name="typeRadio"]')[0].checked = true;
			$('input[name="qdRadio"]')[0].checked = true;

			
			var level = 1;//当前操作员机构等级 1--总公司,2--分公司,3--中支公司,4--四级机构
			
			queryData();
			
			//给指标绑定点击事件
			$('.content').delegate('li','click',function(){

				var type = $('input[name="typeRadio"]:checked').val(),//本日、本月、本年选择
					dateType = $('input[name="dateRadio"]:checked').val();//时间选择
					
				if( type == '1'){
					dateType = dateType.replace(/^[0]/,'') + '月';
				}else if(type == '2'){
					dateType+='年';
				}
				sessionStorage['day'] = dateType;
				sessionStorage['title'] = $(this).attr('data-title');
				//根据不同的机构等级 来存不同的qdType 
				sessionStorage['qdType'+level] = $('input[name="qdRadio"]:checked').val();
				window.location.href = getUrl(level);
			});

			//时间选择
			$('nav').delegate('input[name="dateRadio"]','change',function(){

				console.log($(this).val());

				var label = $(this).parent();
				$('nav').find('label').each(function(index,item){
					if(item == label[0]){
						$(item).addClass('weekAndDate');
					}else{
						$(item).removeClass('weekAndDate');
					}
				});
			});

			//本日、本月、本年选择
			$('.type-choose').delegate('input[name="typeRadio"]','change',function(){

				var val = $(this).val();
				var label = $(this).parent();
				$('.type-choose').find('label').each(function(index,item){
					if(item == label[0]){
						$(item).addClass('chooseed');
					}else{
						$(item).removeClass('chooseed');
					}
				});
				
				if(val == '0'){
					$('nav').html(chooseDay());
				}else if(val == '1'){
					$('nav').html(chooseMonth());
				}else{
					$('nav').html(chooseYear());
				}
				
			});

			//渠道选择
			$('footer').delegate('input[name="qdRadio"]','change',function(){

				console.log($(this).val());
				var label = $(this).parent();

				$('footer').find('label').each(function(index,item){

					var className = item.className;

					if(item == label[0]){
						item.className = className+'2';
					}else{
						item.className = className.replace('2','');
					}
				});

			});

		});

		/**
		 * 查询数据
		 */
		function queryData(){


			var dateRadio = $('input[name="dateRadio"]:checked').val(), //时间选择 的默认值
				qdRadio = $('input[name="qdRadio"]:checked').val();//渠道选择 的默认值

			//....ajax
			var list = ['73.20','2.96','0.1324','2.331','96.21','96.23','97.38','1.01','100'];
		}

		/**
		 * 获取跳转的url
		 * lev 操作员机构等级
		 * return url
		 */
		function getUrl(lev){
			var url = '';
			if(lev == 1){
				url = 'pInfo2.html';
			}else if(lev == 2){
				url = 'pInfo3.html';
			}else if(lev == 3){
				url = 'pInfo4.html';
			}
			return url;
		}

		/**
		 * 选择天
		 */
		function chooseDay(){
			var weekList = {
				'1':'星期一',
				'2':'星期二',
				'3':'星期三',
				'4':'星期四',
				'5':'星期五',
				'6':'星期六',
				'0':'星期日',
			};

			var d = new Date(),arr = new Array();
			d.setDate(d.getDate()-1);//t-1天

			for(var i = 4 ; i >= 0 ; i--){

				var month = d.getMonth() + 1,
					day = d.getDate(),
					week = d.getDay();
				if(i != 4){
					arr[i] ='<label>'+
						'<input type="radio" name="dateRadio" value="'+ ft(month) +'-'+ ft(day)+'" >'+
						'<span>'+ ft(month) +'-'+ ft(day)+'</span>'+
						'<span class="week">'+weekList[week]+'</span>'+
					'</label>';
				}else{
					arr[i] ='<label class="weekAndDate">'+
						'<input type="radio" name="dateRadio" value="'+ ft(month) +'-'+ ft(day)+'" checked="checked">'+
						'<span>'+ ft(month) +'-'+ ft(day)+'</span>'+
						'<span class="week">'+weekList[week]+'</span>'+
					'</label>';
				}
				
				
				d.setDate(day-1);
			}
			return arr.join('');

		}

		/**
		 * 选择月
		 */
		function chooseMonth(){
			var d = new Date(),arr = new Array();
			if(d.getDate() == 1){//如果今天为当月1号 则月份为上一个月
				d.setMonth(d.getMonth()-1);
			}
			d.setDate(27);//加这一句是为了解决 Date对象 setMonth() 时间溢出bug

			for(var i = 4 ; i >= 0 ; i--){
				var month = d.getMonth();

				if(i != 4){
					arr[i] ='<label>'+
						'<input type="radio" name="dateRadio" value="'+ ft(month+1) +'" >'+
						'<span>'+ (month+1) +'</span>'+
						'<span class="week">月</span>'+
					'</label>';
				}else{
					arr[i] ='<label class="weekAndDate">'+
						'<input type="radio" name="dateRadio" value="'+ ft(month+1) +'" checked="checked">'+
						'<span>'+ (month+1) +'</span>'+
						'<span class="week">月</span>'+
					'</label>';
				}
				

				
				d.setMonth(month - 1);
			}
			return arr.join('');
		}

		/**
		 * 选择年
		 */
		function chooseYear(){
			var d = new Date(),arr = new Array();
			if(d.getMonth() == 0 && d.getDate() == 1){//如果今天为1月1号 则年份为上一年
				d.setYear(d.getFullYear() - 1);
			}

			var len = d.getFullYear() - 2016;//数据重2016年开始
			if(len > 4){//最大显示5年
				len = 4;
			}

			for(var i = len ; i >= 0 ; i--){
				var year = d.getFullYear();
				if(i != len){
					arr[i] ='<label>'+
						'<input type="radio" name="dateRadio" value="'+ year +'" >'+
						'<span>'+ year +'</span>'+
						'<span class="week">年</span>'+
					'</label>';
				}else{
					arr[i] ='<label class="weekAndDate">'+
						'<input type="radio" name="dateRadio" value="'+ year +'" checked="checked">'+
						'<span>'+ year +'</span>'+
						'<span class="week">年</span>'+
					'</label>';
				}
				

				d.setYear(d.getFullYear() - 1);
			}
			return arr.join('');
		}

		function ft(val){
			return val > 9 ? val : '0' + val; 
		}

	</script>
</body>
</html>